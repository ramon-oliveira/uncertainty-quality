<!DOCTYPE html>
<html>

<head>
  <!--Import Google Icon Font-->
  <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!--Import materialize.css-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.1/css/materialize.min.css">

  <link href="http://cdn.pydata.org/bokeh/release/bokeh-0.12.4.min.css" rel="stylesheet" type="text/css">
  <link href="http://cdn.pydata.org/bokeh/release/bokeh-widgets-0.12.4.min.css" rel="stylesheet" type="text/css">
  <script src="http://cdn.pydata.org/bokeh/release/bokeh-0.12.4.min.js"></script>
  <script src="http://cdn.pydata.org/bokeh/release/bokeh-widgets-0.12.4.min.js"></script>

  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>

<body>

<div class="container">
<div class="row">
<div class="col s6 offset-s3">
<div class="card blue-grey darken-1">
<div class="card-content white-text">
  <h5>Measurements</h5>
  <table class="bordered">
    <tbody>
      % for m in sorted(info['measurements']):
        <tr>
          <th>${m}</th>
          <td>${'{0:.2f}'.format(info[m])}</td>
        </tr>
      % endfor
    </tbody>
  </table>
</div>
</div>
</div>
</div>
</div>


<%
import pandas as pd
from bokeh.charts import Donut
from bokeh import embed

values = [v for *others, v in info['tables']['components_proportion'][1:]]
labels = info['components']

data = pd.Series(values, index=['{0}: {1:.2f}%'.format(l, v) for l, v in zip(labels, values)])
pie_chart = Donut(data, plot_width=600, plot_height=600)

donut_script, donut_div = embed.components(pie_chart)
%>

<div class="container">
<div class="card">
<div class="card-content">
    <center>
    <h5>Class distribution</h5>
    ${donut_script}
    ${donut_div}
    </center>
</div>
</div>
</div>

<%

import numpy as np
from bokeh.plotting import figure
from bokeh import embed

components = info['components']
cm = np.array(info['confusion_matrix'])
cm_norm = cm/cm.sum(axis=1, keepdims=True)

p = figure(title='Confusion Matrix', plot_width=800, plot_height=600,
           x_range=components, y_range=list(reversed(components)))

for y in range(cm_norm.shape[0]):
    for x in range(cm_norm.shape[1]):
        alpha = cm_norm[y, x]
        p.rect([x+1], [cm_norm.shape[0] - y], width=1, height=1,
               alpha=alpha)
        p.text(x=[x+0.7], y=[cm_norm.shape[0] - y - 0.15],
               text=['{:.2f}%'.format(alpha*100)], text_font_size="10pt")
p.xgrid.grid_line_color = None
p.ygrid.grid_line_color = None
p.yaxis.axis_label = 'True'
p.xaxis.axis_label = 'Predicted'
cm_script, cm_div = embed.components(p)

%>

<div class="container">
<div class="card">
<div class="card-content">
    <center>
    <h5>Confusion Matrix</h5>
    ${cm_script}
    ${cm_div}
    </center>
</div>
</div>
</div>


<%
def to_str(v):
  if type(v) is float:
    return '{0:.2f}'.format(v)
  return v
%>

<div class="container">
<div class="row">
% for k in sorted(info['tables'].keys()):
  <div class="col s6">
  <div class="card blue-grey darken-1">
  <div class="card-content white-text">
    <h5>${k}</h5>
    <table class="bordered">
      <thead>
        <tr>
          % for h in info['tables'][k][0]:
            <th>${h}</th>
          % endfor
        </tr>
      </thead>
      <tbody>
        % for values in info['tables'][k][1:]:
          <tr>
            % for v in values:
                <td>${to_str(v)}</td>
            % endfor
          </tr>
        % endfor
      </tbody>
    </table>
  </div>
  </div>
  </div>
% endfor
</div>
</div>

<%
  from dateutil import parser

  start_time = parser.parse(run['start_time'])
  stop_time = parser.parse(run['stop_time'])
  elapsed = stop_time - start_time
  seconds = int(elapsed.total_seconds())
%>

  <div class="container">
      <div class='row'>
          <div class="col s6">
              <div class="card blue-grey darken-1">
                  <div class="card-content white-text">
                      <h5>Experiment</h5>
                      <table class="bordered">
                          <tbody>
                              <tr>
                                  <td><b>Name</b></td>
                                  <td>${run['experiment']['name']}</td>
                              </tr>
                              <tr>
                                  <td><b>Result</b></td>
                                  <td>${run.get('result')}</td>
                              </tr>
                              <tr>
                                  <td><b>Start time</b></td>
                                  <td>${start_time.strftime('%d/%m/%Y %H:%M:%S')}</td>
                              </tr>
                              <tr>
                                  <td><b>Stop time</b></td>
                                  <td>${stop_time.strftime('%d/%m/%Y %H:%M:%S')}</td>
                              </tr>
                              <tr>
                                  <td><b>Elapsed time</b></td>
                                  <td>${seconds} seconds</td>
                              </tr>
                              <tr>
                                  <td><b>Dependencies</b></td>
                                  <td>
                                      <ul>
                                          % for d in run['experiment']['dependencies']:
                                          <li>${d}</li>
                                          % endfor
                                      </ul>
                                  </td>
                              </tr>
                              <tr>
                                  <td><b>CPU</b></td>
                                  <td>${run['host']['cpu']}</td>
                              </tr>
                              <tr>
                                  <td><b>OS</b></td>
                                  <td>${run['host']['os'][1]}</td>
                              </tr>
                              <tr>
                                  <td><b>Python Version</b></td>
                                  <td>${run['host']['python_version']}</td>
                              </tr>
                          </tbody>
                      </table>
                  </div>
              </div>
          </div>

          <div class="col s6">
              <div class="card blue-grey darken-1">
                  <div class="card-content white-text">
                      <h5>Config</h5>
                      <table class="bordered">
                          <tbody>
                              % for k, v in sorted(config.items()):
                              <tr>
                                  <td><b>${k}</b></td>
                                  % if type(v) is not str or len(v) < 30:
                                  <td>${v}</td>
                                  % else:
                                  <td>${v[:30]}...</td>
                                  % endif
                              </tr>
                              % endfor
                          </tbody>
                      </table>
                  </div>
              </div>
          </div>

      </div>
  </div>



  <!--Import jQuery before materialize.js-->
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/js/materialize.min.js"></script>
</body>

</html>
